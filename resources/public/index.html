<!doctype html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="paren-soup-light.css">
		<style>
			@font-face {
				font-family: 'Fira Code';
				src: url('fonts/FiraCode-Regular.otf') format('opentype');
			}
			html, body, .paren-soup {
				font-family: 'Fira Code';
				height: 100%;
				margin: 0;
			}
			html, body {
				overflow: hidden;
			}
			.paren-soup {
				overflow: auto;
			}
			.paren-soup .content {
				min-height: 100%;
				overflow: hidden;
			}
		</style>
		<!-- script type='text/javascript' src='http://getfirebug.com/releases/lite/1.2/firebug-lite-compressed.js'></script -->
	</head>
	<body>
		<div class="paren-soup" id="paren-soup">
			<div class="numbers" id="numbers"></div>
			<div class="content" contenteditable="true" id="content"></div>
		</div>
		<script type="text/javascript" src="paren-soup.js"></script>
		<script type='text/javascript'>
			var editor = null;
			var lastTextContent = "";
		
			function init() {
				var parent = document.getElementById('paren-soup');
				editor = paren_soup.core.init(parent, function(e) {
					if (window.java) {
						window.java.onchange();
					}
				});
			}

			function undo() {
				paren_soup.core.undo(editor);
			}

			function redo() {
				paren_soup.core.redo(editor);
			}

			function canUndo() {
				if (editor == null) {
					return false;
				}
				return paren_soup.core.can_undo(editor);
			}

			function canRedo() {
				if (editor == null) {
					return false;
				}
				return paren_soup.core.can_redo(editor);
			}
		
			function getTextContent() {
				return document.getElementById('content').textContent;
			}

			function markClean() {
				lastTextContent = getTextContent();
				window.java.onchange();
			}

			function isClean() {
				return lastTextContent == getTextContent();
			}

			function showInstaRepl() {
				var parent = document.getElementById('paren-soup');
				var numbers = document.getElementById('numbers');
				var instarepl = document.createElement('div');
				instarepl.className = 'instarepl';
				instarepl.id = 'instarepl';
				parent.insertBefore(instarepl, numbers);
				init();
			}

			function hideInstaRepl() {
				var parent = document.getElementById('paren-soup');
				var instarepl = document.getElementById('instarepl');
				parent.removeChild(instarepl);
				init();
			}
			
			window.onload = function() {
				if (window.java) {
					window.java.onload();
					markClean();
				}

				init();

				if (window.java) {
					window.java.onchange();
				}
			};
		</script>
	</body>
</html>
