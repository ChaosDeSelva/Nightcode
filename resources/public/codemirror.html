<!doctype html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="codemirror.css">
		<style>
			@font-face {
				font-family: 'Fira Code';
				src: url('fonts/FiraCode-Regular.otf') format('opentype');
			}
			html, body, .CodeMirror {
				height: 100%;
				margin: 0;
			}
			.CodeMirror {
				font-family: 'Fira Code';
			}
		</style>
		<script type='text/javascript' src="codemirror.js"></script>
		<!-- script type='text/javascript' src='http://getfirebug.com/releases/lite/1.2/firebug-lite-compressed.js'></script -->
	</head>
	<body>
		<div id="content"></div>
		<script type='text/javascript'>
			var editor = null;
			var lastTextContent = "";

			function init() {
				var content = document.getElementById("content");
				editor = CodeMirror(document.body, {
					value: content.textContent,
					lineNumbers: true
				});
				if (window.java) {
					editor.on("change", function(editor, change) {
						window.java.onchange();
					});
				}
				document.body.removeChild(content);
			}

			function undo() {
				editor.undo();
			}

			function redo() {
				editor.redo();
			}

			function canUndo() {
				if (editor == null) {
					return false;
				}
				return editor.historySize().undo > 0;
			}

			function canRedo() {
				if (editor == null) {
					return false;
				}
				return editor.historySize().redo > 0;
			}
			
			function getTextContent() {
				return editor.getValue();
			}

			function markClean() {
				lastTextContent = getTextContent();
				window.java.onchange();
			}

			function isClean() {
				return lastTextContent == getTextContent();
			}
			
			window.onload = function() {
				if (window.java) {
					window.java.onload();
				}

				init();

				if (window.java) {
					markClean();
				}
			};
		</script>
	</body>
</html>
